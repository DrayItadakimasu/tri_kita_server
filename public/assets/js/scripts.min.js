document.addEventListener("DOMContentLoaded",(function(){var a=[].slice.call(document.querySelectorAll("img.lazy")),e=[].slice.call(document.querySelectorAll(".lazy-background")),t=[].slice.call(document.querySelectorAll("[data-bg]"));if("IntersectionObserver"in window){let s=new IntersectionObserver((function(a,e){a.forEach((function(a){if(a.isIntersecting){let e=a.target;e.src=e.dataset.src,e.srcset=e.dataset.srcset,e.classList.remove("lazy"),s.unobserve(e)}}))}));a.forEach((function(a){s.observe(a)}));let r=new IntersectionObserver((function(a,e){a.forEach((function(a){a.isIntersecting&&(a.target.classList.add("visible"),r.unobserve(a.target))}))}));e.forEach((function(a){r.observe(a)}));let d=new IntersectionObserver((function(a,e){a.forEach((function(a){if(a.isIntersecting){let e=a.target;e.style.backgroundImage="url("+e.dataset.bg+")",d.unobserve(e)}}))}));t.forEach((function(a){d.observe(a)}))}else a.forEach((function(a){a.src=a.dataset.src,a.srcset=a.dataset.srcset})),e.forEach((function(a){a.classList.add("visible")})),t.forEach((function(a){a.style.backgroundImage="url("+a.dataset.bg+")"}))})),document.addEventListener("DOMContentLoaded",(function(){if(jQuery(".rating-input").each((function(a){let e=$(".rating-input .rating-star-big");e.length;jQuery(".rating-input").on("click",".rating-star-big",(function(){var a=e.index(this)+1;if(e.siblings("input").val(a),e.removeClass("full_star-big"),!e.eq(a-1).hasClass("full_star-big")){e.eq(a);e.each((function(e){if(a-1<e)return!1;$(this).addClass("full_star-big")}))}}))})),jQuery(".rating-output").each((function(a){let e=jQuery(this).attr("data-rating");jQuery(this).children(".rating-star").removeClass("half-star"),jQuery(this).children(".rating-star").removeClass("empty-star"),jQuery(this).children(".rating-star").removeClass("full-star"),jQuery(this).children(".rating-star").addClass("empty-star"),e>0&&e<1?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("half-star")):1==e?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star")):e>1&&e<2?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("half-star")):2==e?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star")):e>2&&e<3?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("half-star")):3==e?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("full-star")):e>3&&e<4?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(3).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("full-star"),jQuery(this).children(".rating-star").eq(3).addClass("half-star")):4==e?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(3).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("full-star"),jQuery(this).children(".rating-star").eq(3).addClass("full-star")):e>4&&e<5?(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(3).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(4).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("full-star"),jQuery(this).children(".rating-star").eq(3).addClass("full-star"),jQuery(this).children(".rating-star").eq(4).addClass("half-star")):5==e&&(jQuery(this).children(".rating-star").eq(0).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(1).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(2).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(3).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(4).removeClass("empty-star"),jQuery(this).children(".rating-star").eq(0).addClass("full-star"),jQuery(this).children(".rating-star").eq(1).addClass("full-star"),jQuery(this).children(".rating-star").eq(2).addClass("full-star"),jQuery(this).children(".rating-star").eq(3).addClass("full-star"),jQuery(this).children(".rating-star").eq(4).addClass("full-star"))})),jQuery(".mob-menu-but").click((function(){jQuery(".mob-menu-container").addClass("mob-menu-active")})),jQuery(".mob-menu-close").click((function(){jQuery(".mob-menu-container").removeClass("mob-menu-active")})),$(".bt-accordion").click((function(){$(".filter-form").hasClass("active")?($(".filter-form").hide("slow",(function(){})).removeClass("active"),$(this).text("Показать фильтры")):($(".filter-form").show("slow",(function(){})).addClass("active"),$(this).text("Скрыть фильтры"))})),$(".map-accordion").click((function(){$(".map-container").hasClass("active")?($(".map-container").toggle({complete:function(){},duration:"slow"}).removeClass("active"),$(this).text("Показать на карте")):($(".map-container").toggle({complete:function(){},duration:"slow"}).addClass("active"),$(this).text("Скрыть карту")),window.dispatchEvent(new Event("resize"))})),$(".user-menu").click((function(){var a=$(this).find(".dropdown-menu");a.hasClass("show")?a.removeClass("show").hide(500):a.addClass("show").show(500)})),$('input[name="phone"]').mask("+7 (999) 999-99-99"),"undefined"!=typeof L&&"undefined"!=typeof addressPoints){$.ajaxSetup({type:"post",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},dataType:"json",error:function(a,e,t){console.log("Ошибка: "+e+" | "+t)}});var a=L.map("map").setView([46.529,41.342],6);screen.width>960&&a.scrollWheelZoom.disable(),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'}).addTo(a);for(var e=L.icon({iconUrl:"assets/img/marker.png",iconSize:[32,32],iconAnchor:[15,27],popupAnchor:[-3,-20]}),t=new L.MarkerClusterGroup,s=0;s<addressPoints.length;s++){var d=addressPoints[s],l=d[2],n=new L.Marker(new L.LatLng(d[0],d[1]),{id:l,icon:e});function o(a){var e,t,s=a.target;console.log(s),r=(e=a.target.options.id,$.ajax({type:"post",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/getdata/application",data:{s:e},dataType:"json",success:function(a){return a}})),r.done((function(a){console.log(a),t="<h3>"+a.culture.name+"</h3>",t+="Погрузка: "+a.load_full_address+"<br>",t+="Выгрузка: "+a.unload_full_address+"<br>",t+="Расстояние: "+a.distance+" км. <br>",t+="Объем: "+a.amount+" т.<br>",t+="Цена: "+a.cost+" руб/кг. <br> <hr>",t+="<b>"+a.client.org+"</b>",console.log(a.client.phone),void 0===a.client.phone?t+='<b> <a href="/lk/application/'+a.id+'">Узнать больше</a></b>':(t+='<b> Тел: <a href="tel:'+a.client.phone+'">'+a.client.phone+"</a></b>",t+='<br><b> <a class="blue-btn" href="/lk/application/'+a.id+'">Узнать больше</a></b>'),s.bindPopup(t),s.openPopup()}))}t.addLayer(n),n.on("click",o)}a.addLayer(t)}$("#loadselect, #unloadselect").select2({placeholder:0,language:{noResults:function(a){return"Ничего не найдено"},searching:function(){return"Поиск в системе ..."}},ajax:{type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/getdata/loadplace",data:function(a){return{s:a.term,where:$(this).attr("name")}},processResults:function(a){return{results:$.map(a,(function(a){return console.log(a),a.load_area||a.load_city||a.load_settlement||a.load_full_address||a.load_region?(a.load_area||(a.load_area=""),a.load_city||(a.load_city=""),a.load_settlement||(a.load_settlement=""),a.load_city?$idData=a.load_city:a.load_area?$idData=a.load_area:$idData=a.load_settlement,a.load_region&&!a.load_full_address?{text:a.load_region,id:a.load_region}:{text:a.load_area+" "+a.load_full_address,id:a.load_full_address}):a.unload_area||a.unload_city||a.unload_settlement||a.unload_full_address||a.unload_region?(a.unload_area||(a.unload_area=""),a.unload_city||(a.unload_city=""),a.unload_settlement||(a.unload_settlement=""),a.unload_city?$idData=a.unload_city:a.unload_area?$idData=a.unload_area:$idData=a.unload_settlement,a.unload_region&&!a.unload_full_address?{text:a.unload_region,id:a.unload_region}:{text:a.unload_area+" "+a.unload_full_address,id:a.unload_full_address}):void 0}))}}}}),$(document).ready((function(){$(".loading-input-container select").select2({language:{noResults:function(a){return"Ничего не найдено"},searching:function(){return"Поиск в системе ..."}}}),$(".select-region-load").on("select2:select",(function(a){$("#load_address").removeAttr("disabled");var e=a.params.data.id;load_address_data.constraints.locations.kladr_id=e,$("#load_address").suggestions(load_address_data),$("#load_address").removeAttr("disabled")})),$(".select-region-unload").on("select2:select",(function(a){$("#unload_address").removeAttr("disabled");var e=a.params.data.id;i.constraints.locations.kladr_id=e,$("#unload_address").suggestions(i)}))})),load_address_data={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"city-settlement",constraints:{locations:{kladr_id:""}},onSelect:function(a){console.log(a),$("#load_address").attr("data_value",a.value),window.dataSecure.load_full_address=!0,$("#load_region").val(a.data.region_with_type),$("#load_region_code").val(a.data.region_kladr_id),$("#load_area").val(a.data.area_with_type),$("#load_area_code").val(a.data.area_kladr_id),$("#load_city").val(a.data.city_with_type),$("#load_city_code").val(a.data.city_kladr_id),$("#load_settlement").val(a.data.settlement_with_type),$("#load_settlement_code").val(a.data.settlement_kladr_id),$("#load_street").val(a.data.street_with_type),$("#load_street_code").val(a.data.street_kladr_id),$("#load_house").val(a.data.house),$("#load_lat").val(a.data.geo_lat).getDistance(),$("#load_lon").val(a.data.geo_lon).getDistance(),$("#load_place").removeAttr("disabled"),a.data.settlement_kladr_id&&(c.constraints.locations.kladr_id=a.data.settlement_kladr_id),a.data.city_kladr_id&&(c.constraints.locations.kladr_id=a.data.city_kladr_id),$("#load_place").suggestions(c),a.data.area_with_type?$("#load_area_label").text(a.data.area_with_type):$("#load_area_label").empty()}};var i={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"city-settlement",constraints:{locations:{kladr_id:""}},onSelect:function(a){window.dataSecure.unload_full_address=!0,$("#unload_address").attr("data_value",a.value),$("#unload_region").val(a.data.region_with_type),$("#unload_region_code").val(a.data.region_kladr_id),$("#unload_area").val(a.data.area_with_type),$("#unload_area_code").val(a.data.area_kladr_id),$("#unload_city").val(a.data.city_with_type),$("#unload_city_code").val(a.data.city_kladr_id),$("#unload_settlement").val(a.data.settlement_with_type),$("#unload_settlement_code").val(a.data.settlement_kladr_id),$("#unload_street").val(a.data.street_with_type),$("#unload_street_code").val(a.data.street_kladr_id),$("#unload_house").val(a.data.house),$("#unload_lat").val(a.data.geo_lat).getDistance(),$("#unload_lon").val(a.data.geo_lon).getDistance(),$("#unload_place").removeAttr("disabled"),a.data.settlement_kladr_id&&(u.constraints.locations.kladr_id=a.data.settlement_kladr_id),a.data.city_kladr_id&&(u.constraints.locations.kladr_id=a.data.city_kladr_id),$("#unload_place").suggestions(u),a.data.area_with_type?$("#unload_area_label").text(a.data.area_with_type):$("#unload_area_label").empty()}},c={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"PARTY",constraints:{locations:{kladr_id:""}},onSelect:function(a){$("#load_place").attr("data_value",a.value),$("#load_region").val(a.data.address.data.region_with_type),$("#load_region_code").val(a.data.address.data.region_kladr_id),$("#load_area").val(a.data.address.data.area_with_type),$("#load_area_code").val(a.data.address.data.area_kladr_id),$("#load_city").val(a.data.address.data.city_with_type),$("#load_city_code").val(a.data.address.data.city_kladr_id),$("#load_settlement").val(a.data.address.data.settlement_with_type),$("#load_settlement_code").val(a.data.address.data.settlement_kladr_id),$("#load_street").val(a.data.address.data.street_with_type),$("#load_street_code").val(a.data.address.data.street_kladr_id),$("#load_house").val(a.data.address.data.house),$("#load_lat").val(a.data.address.data.geo_lat).getDistance(),$("#load_lon").val(a.data.address.data.geo_lon).getDistance()}},u={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"PARTY",constraints:{locations:{kladr_id:""}},onSelect:function(a){console.log(a.data.address.data),window.dataSecure.unload_place=!0,$("#unload_place").attr("data_value",a.value),$("#unload_region").val(a.data.address.data.region_with_type),$("#unload_region_code").val(a.data.address.data.region_kladr_id),$("#unload_area").val(a.data.address.data.area_with_type),$("#unload_area_code").val(a.data.address.data.area_kladr_id),$("#unload_city").val(a.data.address.data.city_with_type),$("#unload_city_code").val(a.data.address.data.city_kladr_id),$("#unload_settlement").val(a.data.address.data.settlement_with_type),$("#unload_settlement_code").val(a.data.address.data.settlement_kladr_id),$("#unload_street").val(a.data.address.data.street_with_type),$("#unload_street_code").val(a.data.address.data.street_kladr_id),$("#unload_house").val(a.data.address.data.house),$("#unload_lat").val(a.data.address.data.geo_lat).getDistance(),$("#unload_lon").val(a.data.address.data.geo_lon).getDistance()}};function _(){return $("#load_address").attr("data_value")==$("#load_address").val()&&$("#unload_address").attr("data_value")==$("#unload_address").val()}$("#new_exporter").suggestions({token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"PARTY",onSelect:function(a){}}),$(".default-address").suggestions({token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",onSelect:function(a){}}),$("#load_address").on("blur",(function(){$("#load_address").val($("#load_address").val().trim())})),$("#unload_address").on("blur",(function(){$("#unload_address").val($("#unload_address").val().trim())})),window.dataSecure={load_full_address:!1,unload_full_address:!1,unload_place:!1,allowSend:function(){if(console.log(_()),this.load_full_address&&this.unload_full_address&&_())return!0;alert("Данные не верны, поля - Населенный пункт погрузки, Населенный пункт выгрузки, - должны быть заполнены путем выбора из выпадающего списка, не допускается ввода иной информации")}},$.fn.getDistance=function(){var a=$("#load_lat").val(),e=$("#load_lon").val(),t=$("#unload_lat").val(),s=$("#unload_lon").val();""!=a&&""!=e&&""!=t&&""!=s&&$.ajax({type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/getdata/distance",dataType:"json",data:{load_lat:a,load_lon:e,unload_lat:t,unload_lon:s},beforeSend:function(){$("#distance").attr("disabled","")},success:function(a){$("#distance").removeAttr("disabled"),a.errors?$("#distance").attr("placeholder",a.message):$("#distance").val(a.distance)},error:function(){$("#distance").removeAttr("disabled"),$("#distance").attr("placeholder","Ошибка отправки запроса на расчет")}})};var h={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"area",constraints:{locations:{kladr_id:""}},onSelect:function(a){}};$("#subscribe_load_region").suggestions({token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"region",onSelect:function(a){$("#subscribe_load_area").removeAttr("disabled"),h.constraints.locations.kladr_id=a.data.region_kladr_id,$("#subscribe_load_area").val(""),$("#subscribe_load_area").suggestions(h)}});var g={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"area",constraints:{locations:{kladr_id:""}},onSelect:function(a){y.constraints.locations.kladr_id=a.data.area_kladr_id,y.bounds="city-settlement",$("#subscribe_unload_settlement").val(""),$("#subscribe_unload_settlement").suggestions(y),$("#subscribe_unload_settlement").removeAttr("disabled")}},y={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"city-settlement",constraints:{locations:{kladr_id:""}},onSelect:function(a){$("#subscribe_unload_org").val(""),m.constraints.locations.kladr_id=a.data.kladr_id,$("#subscribe_unload_org").suggestions(m),$("#subscribe_unload_org").removeAttr("disabled")}},m={token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"PARTY",constraints:{locations:{kladr_id:""}},onSelect:function(a){}};$("#subscribe_unload_region").suggestions({token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"ADDRESS",bounds:"region",onSelect:function(a){$("#subscribe_unload_area").removeAttr("disabled"),$("#subscribe_unload_settlement").removeAttr("disabled"),y.constraints.locations.kladr_id=a.data.region_kladr_id,y.bounds="city",$("#subscribe_unload_settlement").suggestions(y),g.constraints.locations.kladr_id=a.data.region_kladr_id,$("#subscribe_unload_area").val(""),$("#subscribe_unload_area").suggestions(g)}}),$("#inn").suggestions({token:"483b95b0ba0126846c2b39ca578caa921365e8cc",type:"PARTY",onSelect:function(a){$("#inn").val(a.data.inn),$("#agency_name").val(a.data.name.full_with_opf),$("#ogrn").val(a.data.ogrn)}}),$(".del-subscr").on("click",(function(){let a,e,t,s;s=$(this),t=$(this).attr("data-subscribe-type"),e=$(this).attr("data-subscribe-id"),user_id=$(this).attr("data-user-id"),$(this).is(":checked")?(console.log(e),console.log("ON"),a=1):(console.log(e),console.log("OFF"),a=0),$.ajax({type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/lk/profile/"+user_id+"/subscribe/update/"+t+"/"+e+"?set_status="+a,dataType:"json",beforeSend:function(){$(this).closest("slider").css("opacity","0.5")},success:function(e){if("fail"==e.status)return 1==a&&s.prop("checked",!1),0==a&&s.prop("checked",!0),!1;$(this).closest("slider").css("opacity","1")},error:function(e){alert("Ошибка отправки запроса"),1==a&&s.prop("checked",!1),0==a&&s.prop("checked",!0)}})})),$(".user_settings_checkbox").on("click",(function(){let a,e,t,s;s=$(this),t=$(this).attr("data-setting"),e=$(this).attr("data-id"),$(this).is(":checked")?(console.log(e),console.log("ON"),a=1):(console.log(e),console.log("OFF"),a=0),$.ajax({type:"POST",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content")},url:"/lk/profile/update/"+e+"?action="+t+"&status="+a,dataType:"json",beforeSend:function(){$(this).closest("slider").css("opacity","0.5")},success:function(e){if("fail"==e.status)return 1==a&&s.prop("checked",!1),0==a&&s.prop("checked",!0),!1;$(this).closest("slider").css("opacity","1")},error:function(e){alert("Ошибка отправки запроса"),1==a&&s.prop("checked",!1),0==a&&s.prop("checked",!0)}})}));var p=$(".back");document.referrer&&(p.show(),p.click((function(){return history.back(),!1})));let b=document.querySelector("#map"),f=document.querySelector(".thead-fixed");function v(a){let e=a.replace(/[^.+\d]/g,"");return Number(e)}function k(a,e){let t=document.querySelector(e),s=document.querySelector(a);if(!s)return!1;{let a=getComputedStyle(t).marginRight,e=getComputedStyle(s).width,r=getComputedStyle(t).paddingRight,d=v(a)+v(e)+(2*v(r)+1);s.style.width=d+"px"}}window.addEventListener("scroll",a=>{let e=window.innerHeight/1.5,t=document.querySelector(".table").getBoundingClientRect().top,s=document.querySelector(".show-map");console.log(t),console.log(e),t<e?(b.classList.add("hide"),s.style.display="block"):b.style.display="block",s.onclick=function(){b.classList.remove("hide"),s.style.display="none"},t<0?f.classList.add("fix-thead"):f.classList.remove("fix-thead")}),window.innerWidth>767&&(k(".left-image-child",".container"),k(".bg-gray-child",".container"))}));